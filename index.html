<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" 
          content="width=device-width, 
                   initial-scale=1.0">
    <title>PASTI - PAncam Suggested Target Interface</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
  <div id = "container">
    
    <div id="threejs-container">
      
        <div id="threejs-canvas"></div>
        
          <div id = 'ui-container'>
           <p id="solSelectLabel" style="position:absolute; bottom:0.8vw; left:42.5vw; width:15vw; color: white; background-color:#00000085; font-size: 1vw; text-align: center;">No Sol Selected</p>
           <button id="openDaySelector" class = "btn btn-secondary"style=" left: calc(50vw - 1.5vw); position:absolute; bottom: 3.2vw; width: 3vw; height: 3vw; z-index: 100000; color: black; background-color:#e3e3e3; "><i class="bi bi-calendar3"></i></button>

            <button id="zoomIn" onclick="zoomIn()"class = "btn btn-secondary" style="left: 96vw; position:absolute; bottom:91vh; width:1vw;height: 4vh;font-size:0.75vw; color: black;background-color:#e3e3e3c8;">+</button>
          <button id="zoomOut" onclick="zoomOut()" class = "btn btn-secondary"style="left: 96vw; position:absolute; bottom:87vh;width: 1vw ;height: 4vh; font-size:0.75vw; color: black;background-color:#e3e3e3c8;">-</button>
            <button id="resetZoom" onclick="resetView()" class = "btn btn-secondary"style="left: 96vw; position:absolute; bottom:82.5vh; width: 1vw ;height: 4vh; font-size:0.75vw; color: black; background-color:#e3e3e3c8; border-color: black;" ><i class="bi bi-arrow-clockwise"></i></button>
           
    
<!-- Sidebar Toggle Buttons -->
<div class="position-fixed top-0 end-0 d-flex gap-1 m-0">
  <button id="openBtn1"
          class="btn btn-secondary icon-btn"
          onclick="toggleSidebar(1)">
     <i class="bi bi-gear"></i>
  </button>

  <button id="openBtn2"
          class="btn btn-secondary icon-btn"
          onclick="toggleSidebar(2)">
   <i class="bi bi-crosshair" ></i>
  </button>

    <button id="openBtn3"
          class="btn btn-secondary icon-btn" onclick="toggleSidebar(3)">
   
   <i class="bi bi-question-circle-fill"></i>
  </button>
</div>
      <div id="buttontooltip" 
     style="position:absolute; display:none; background:#333; color:#fff; padding:5px 10px; border-radius:4px; font-size:1vh; pointer-events:none; z-index:10000;"></div>
    </div>

<!-- Sidebar 1 control panel -->
<div id="mySidebar1"
     class="position-fixed top-0 end-0 d-flex flex-column"
     style="width:15vw; height:40vh; transform: translateY(100vh); background:#232323e2; color:#fff;">

  <!-- Header -->
    <div class="d-flex align-items-center border-bottom px-2"
        style="flex: 0 1 auto; font-size:1.8vh;">
      <button id="closeSidebarBtn1"
              class="btn btn-sm btn-outline-light d-flex align-items-center justify-content-center"
              style="width:3vw; height:3vh; font-size:2vh;"
              onclick="closeSidebar(1)">&times;</button>
      <h5 class="mb-0 ms-2 fw-bold" style="font-size:2vh;">Control Panel</h5>
    </div>

  <!-- Main content area -->
<div class="sidebar-content d-flex flex-column gap-2 p-2"
     style="flex: 1 1 auto; min-height:0;">



    <!-- Target Controls -->
    <div class="d-flex gap-0">
      <button id="targetClear" onclick="clearMarkers()" class="btn btn-outline-danger flex-fill d-flex align-items-center justify-content-center text-nowrap" style="font-size:1.5vh;">Clear Suggestions</button>
      <button id="targetSend" onclick="" class="btn btn-outline-primary flex-fill d-flex align-items-center justify-content-center text-nowrap" style="font-size:1.5vh;">Send & Confirm</button>
    </div>

    <!-- File Controls -->
    <div class="d-flex flex-column gap-1">
      <button onclick="jsonDownload()" id="download" class="btn btn-info w-100 d-flex align-items-center justify-content-center" style="font-size:1.4vh;">Download Local Suggestions</button>
      <input type="file" id="jsonFile" accept=".json" class="form-control form-control-sm" style="font-size:1vh;">
      <button id="upload" onclick="jsonUpload()" class="btn btn-secondary w-100 d-flex align-items-center justify-content-center" style="font-size:1.4vh;">Show Local Suggestions</button>
    </div>

    <!-- Checkboxes -->
<div class="d-flex gap-1">
  <label class="form-check">
    <input class="form-check-input" type="checkbox" id="scales" onclick="coordGrid()">
    Coordinate Gridlines
  </label>
  <label class="form-check">
    <input class="form-check-input" type="checkbox" id="markerShow" onclick="markerShow()" checked>
    Show Suggestions
  </label>
</div>
</div>
  <!-- Footer / Instructions -->
  <div class="border-top p-1" style="border-color: #444; font-size:1.4vh; line-height:1.3; color:#ddd;">
    <strong>Controls:</strong><br>
    Double Left Click – Place Marker<br>
    Shift + Left Click – Draw Patch<br>
    Right Click – Pan<br>
    W: WAC FoV | H: HRC FoV | E: Enfys FoV
  </div>




</div>
<!-- Sidebar 2 current targets-->

<div id="mySidebar2"
     class="border-start shadow position-fixed top-0 end-0"
     style="
       width:15vw;
       transform:translateY(100vh);
       transition: transform 0.3s ease;
       z-index:10001;
       background:#232323e2;
       color:#fff;
     ">

  <!-- Header -->
  <div class="d-flex align-items-center border-bottom px-2"
       style="height:6vh; font-size:2.5vh;">
    <button id="closeSidebarBtn2"
            class="btn btn-sm btn-outline-light d-flex align-items-center justify-content-center"
            style="width:3vw; height:3vh; font-size:2vh;"
            onclick="closeSidebar(2)">&times;</button>
    <h5 class="mb-0 ms-2 fw-bold" style="font-size:2vh;">
      Current Suggestions
    </h5>
  </div>

  <!-- Scrollable list -->
  <div id="markerList"
       class="list-group list-group-flush"
       style="
         height: calc(100vh - 6vh);
         overflow-y: auto;
       ">
    <!-- Items go here -->
  </div>

</div>

<div id="mySidebar3"
     class="border-start shadow position-fixed top-0 end-0"
     style="
       width:15vw;
       transform:translateY(100vh);
       transition: transform 0.3s ease;
       z-index:10001;
       background:#232323e2;
       color:#fff;
     ">

  <!-- Header -->
  <div class="d-flex align-items-center border-bottom px-2"
       style="height:6vh; font-size:2.5vh;">
    <button id="closeSidebarBtn3"
            class="btn btn-sm btn-outline-light d-flex align-items-center justify-content-center"
            style="width:3vw; height:3vh; font-size:2vh;"
            onclick="closeSidebar(3)">&times;</button>
    <h5 class="mb-0 ms-2 fw-bold" style="font-size:2vh;">
     WELCOME TO PASTI
    </h5>
  </div>
  Pasti is a.....
    <img src="PanCamLogo.png" alt="Mars surface" style="width:5vw; object-fit:cover;">
</div>

    </div>

  </div>

</div>



<div id="popupForm" class="popup" style="display:none;">
  <div id="popupHeader">Suggestion Form</div>
  <div class="popup-body">
    <form id="markerForm">
      <div class="input-row">
        <label>Title: <input type="text" name="title" /></label>
        <label>Suggestion ID: <input type="text" name="suggestionID" readonly /></label>
        <label>User ID: <input type="text" name="userID" readonly /></label>
      </div>

      <div class="input-row">
        <label>Description:<textarea name="description"></textarea></label>
        <label>Science Intent:<textarea name="intent"></textarea></label>
      </div>
      
      <div class="checkboxes">
        <label><input type="checkbox" name="HRC" /> HRC</label>
        <label><input type="checkbox" name="enfys" /> Enfys</label>
        <label><input type="checkbox" name="wacRGB" /> WAC RGB</label>
        <label><input type="checkbox" name="wacmulti" /> WAC Multispectral</label>
        <label><input type="checkbox" name="mosaic" /> Mosaic</label>
      </div>

      <div class = 'input-row'>
        <label>Keywords:</label>

              <div class="multi-select">
        <button type="button" id="keywordDropdownBtn">Select Keywords ▼</button>
        <div id="keywordDropdown" class="dropdown-content">
          <label><input type="checkbox" name="keywords" value="Keyword 1"> Keyword 1</label>
          <label><input type="checkbox" name="keywords" value="Keyword 2"> Keyword 2</label>
          <label><input type="checkbox" name="keywords" value="Keyword 3"> Keyword 3</label>
        </div>
      </div>
        </div>
        <label><input type="text" id="selectedKeywords" name="selectedKeywords" style = 'width: 100%'readonly/></label>

      <label>Other Notes:<textarea name="notes"></textarea></label>

      <div class="popup-buttons">
        <button type="submit">Save</button>
        <button type="button" onclick="cancelPopup()">Cancel</button>
      </div>
    </form>
  </div>
</div>



            
<div id="tooltip" style="display:none; position: fixed; pointer-events:none; background:white; border:1px solid black; padding:5px; z-index:2000; overflow-wrap: break-word; max-width:30vw; font-size: 1vw;"></div>




<!-- Three.js core -->
<script src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
<!-- OrbitControls -->
<script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

<!-- Gather Data -->
<script src="js_scripts2/Coords.js"></script>

<!-- Graphical Setup Script-->
<script src="js_scripts2/GraphicalSetup.js"></script>

<!-- Texture Loader Script-->
<script src="js_scripts2/TextureLoad.js"></script>

<!-- Marker Placing Script-->
<script src="js_scripts2/MarkerPlacement.js"></script>

<!-- PopupForm Script-->
<script src="js_scripts2/PopupForms.js"></script>

<!-- Key Press Script-->
<script src="js_scripts2/KeyPressFunctions.js"></script>

<!-- json Handler Script-->
<script src="js_scripts2/jsonHandler.js"></script>

<!-- Miscelleanous Functions Script-->
<script src="js_scripts2/MiscFunctions.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>





<script>
// Initial variables required before anything else can take place.
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();
let markers = [];
let meshes = [];
var w = innerWidth / 1.5, h = innerHeight / 1.5;
const rect = renderer.domElement.getBoundingClientRect();
renderer.domElement.tabIndex = 0;
renderer.domElement.style.outline = "none";
renderer.domElement.focus();
//const markerColor = '#' + Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0');
const markerColor = '#'+'40be9b'

// Listen for resize events

window.addEventListener('resize', onWindowResize, false);
const threejsContainer = document.getElementById('threejs-container');
threejsContainer.insertBefore(hud, threejsContainer.firstChild);
//const markerColor  = 0xffff00

function toggleSidebar(num) {
  const sidebar = document.getElementById(`mySidebar${num}`);
  const openbtn = document.getElementById(`openBtn${num}`);
  const isOpen = sidebar.style.transform === "translateY(60vh)";

  //openbtn.innerHTML = isOpen? '<':'>';
  sidebar.style.transform = isOpen ? "translateY(0)" : "translateY(60vh)";
}

function closeSidebar(num) {
  const sidebar = document.getElementById(`mySidebar${num}`);
  const openbtn = document.getElementById(`openBtn${num}`);
  sidebar.style.transform = 'translateY(100vh)';

  const isOpen = sidebar.style.transform === "translateY(60vh)";
  //openbtn.innerHTML = isOpen? '<':'>';

}

const tooltip = document.getElementById('buttontooltip');
const buttons = [
  { el: document.getElementById('openBtn1'), text: 'Control Panel' },
  { el: document.getElementById('openBtn2'), text: 'Current Suggestions' },
  { el: document.getElementById('openBtn3'), text: 'TBD' },
];


buttons.forEach(btn => {
  btn.el.addEventListener('mouseenter', (e) => {
    tooltip.innerText = btn.text;
    tooltip.style.display = 'block';


    tooltip.style.left = e.pageX - 40  + 'px';
    
    tooltip.style.top = e.pageY -40 + 'px';

  });

  btn.el.addEventListener('mousemove', (e) => {

    tooltip.style.left = e.pageX -40 + 'px';
    tooltip.style.top = e.pageY - 40 + 'px';
  });

  btn.el.addEventListener('mouseleave', () => {
    tooltip.style.display = 'none';
  });
});

function animate() {
    requestAnimationFrame(animate);
    controls.update();
    updateCameraRulers();
    renderer.render(scene, camera);
  }

const popup = document.getElementById("popupForm");
const header = document.getElementById("popupHeader");

let offsetX = 0, offsetY = 0;
let isDragging = false;
  header.addEventListener("mousedown", (e) => {
  isDragging = true;
  // Mouse position relative to popup top-left corner
  offsetX = e.clientX - popup.offsetLeft;
  offsetY = e.clientY - popup.offsetTop;
  document.body.style.userSelect = "none"; // prevent text selection while dragging
});

document.addEventListener("mouseup", () => {
  isDragging = false;
  document.body.style.userSelect = ""; // restore
});

document.addEventListener("mousemove", (e) => {
  if (!isDragging) return;
  // Calculate new position
  let left = e.clientX - offsetX;
  let top = e.clientY - offsetY;

  // Optional: constrain within viewport
  const maxLeft = window.innerWidth - popup.offsetWidth;
  const maxTop = window.innerHeight - popup.offsetHeight;
  left = Math.max(0, Math.min(left, maxLeft));
  top = Math.max(0, Math.min(top, maxTop));

  popup.style.left = left + "px";
  popup.style.top = top + "px";
});

document.addEventListener('DOMContentLoaded', () => {
  const btn = document.getElementById('keywordDropdownBtn');
  const dropdown = document.getElementById('keywordDropdown');
  const input = document.getElementById('selectedKeywords');

  // Toggle dropdown visibility
  btn.addEventListener('click', () => {
    dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
  });

  // Close dropdown if clicked outside
  document.addEventListener('click', (e) => {
    if (!dropdown.contains(e.target) && e.target !== btn) {
      dropdown.style.display = 'none';
    }
  });

  // Update input when checkboxes change
  dropdown.querySelectorAll('input[type="checkbox"]').forEach(cb => {
    cb.addEventListener('change', () => {
      const selected = Array.from(dropdown.querySelectorAll('input[type="checkbox"]:checked'))
                           .map(c => c.value);
      input.value = selected.join(', ');
    });
  });
});
  </script>

</body>
</html>